<!doctype html>
<title>UNICENS: XML Autocomplete Demo</title>
<meta charset="utf-8" />
<link rel=stylesheet href="https://raw.githubusercontent.com/unicens/CodeMirror/master/doc/docs.css">
<link rel="stylesheet" href="https://raw.githubusercontent.com/unicens/CodeMirror/master/lib/codemirror.css">
<link rel="stylesheet" href="https://raw.githubusercontent.com/unicens/CodeMirror/master/addon/hint/show-hint.css">
<script src="https://raw.githubusercontent.com/unicens/CodeMirror/master/lib/codemirror.js"></script>
<script src="https://raw.githubusercontent.com/unicens/CodeMirror/master/addon/hint/show-hint.js"></script>
<script src="https://raw.githubusercontent.com/unicens/CodeMirror/master/addon/hint/xml-hint.js"></script>
<script src="https://raw.githubusercontent.com/unicens/CodeMirror/master/mode/xml/xml.js"></script>
<style type="text/css">
    .CodeMirror {
        border: 1px solid #eee;
    }
</style>
<article>
    <form>
        <textarea id="code" name="code"><!-- write some xml below -->
</textarea>
    </form>

    <script>

        var tags = {
            "!top": ["Unicens"],
            "Unicens": {
                "attrs": {
                    "AsyncBandwidth": null
                },
                "children": ["Node", "Script"]
            },
            "Node": {
                "attrs": {
                    "Address": null,
                    "Script": null
                },
                "children": ["USBPort", "MediaLBPort", "StreamPort", "SyncConnection", "AVPConnection"]
            },
            "USBPort": {
                "attrs": {
                    "PhysicalLayer": ["Standard", "HSIC"],
                    "DeviceInterfaces": null,
                    "StreamingIfEpInCount": null,
                    "StreamingIfEpOutCount": null
                },
                "children": []
            },
            "MediaLBPort": {
                "attrs": {
                    "ClockConfig": ["256Fs", "512Fs", "1024Fs", "2048Fs", "3072Fs", "4096Fs", "6144Fs", "8192Fs"]
                },
                "children": []
            },
            "StreamPort": {
                "attrs": {
                    "ClockConfig": ["8Fs", "16Fs", "32Fs", "64Fs", "128Fs", "256Fs", "512Fs", "Wildcard"],
                    "DataAlignment": ["Left16Bit", "Left24Bit", "Right16Bit", "Right24Bit", "Seq"]
                },
                "children": []
            },
            "SyncConnection": {
                "attrs": {
                    "Bandwidth": null,
                    "DefaultMute": ["false", "true"],
                    "MuteMode": ["NoMuting", "MuteSignal", "AutoMute"]
                },
                "children": ["MOSTSocket", "USBSocket", "MediaLBSocket", "StreamSocket", "Splitter", "Combiner"]
            },
            "AVPConnection": {
                "attrs": {
                    "Bandwidth": null,
                    "IsocPacketSize": ["188", "196", "206"]
                },
                "children": ["MOSTSocket", "USBSocket", "MediaLBSocket", "StreamSocket", "Splitter", "Combiner"]
            },
            "MOSTSocket": {
                "attrs": {
                    "Route": null,
                    "Offset": null
                },
                "children": []
            },
            "USBSocket": {
                "attrs": {
                    "EndpointAddress": null,
                    "FramesPerTransaction": null
                },
                "children": []
            },
            "MediaLBSocket": {
                "attrs": {
                    "ChannelAddress": null
                },
                "children": []
            },
            "StreamSocket": {
                "attrs": {
                    "StreamPinID": ["SRXA0", "SRXA1", "SRXB0", "SRXB1"]
                },
                "children": []
            },
            "Splitter": {
                "children": ["MOSTSocket"]
            },
            "Combiner": {
                "children": ["MOSTSocket"]
            },
            "Script": {
                "attrs": {
                    "Name": null
                },
                "children": ["GPIOPortCreate", "GPIOPortPinMode", "GPIOPinState", "I2CPortCreate", "I2CPortWrite", "I2CPortRead", "MsgSend"]
            },
            "GPIOPortCreate": {
                "attrs": {
                    "DebounceTime": null
                },
                "children": []
            },
            "GPIOPortPinMode": {
                "attrs": {
                    "PinConfiguration": null
                },
                "children": []
            },
            "GPIOPinState": {
                "attrs": {
                    "Mask": null,
                    "Data": null
                },
                "children": []
            },
            "I2CPortCreate": {
                "attrs": {
                    "Speed": ["SlowMode", "FastMode"]
                },
                "children": []
            },
            "I2CPortWrite": {
                "attrs": {
                    "Mode": ["DefaultMode", "RepeatedStartMode", "BurstMode"],
                    "BlockCount": null,
                    "Address": null,
                    "Length": null,
                    "Payload": null,
                    "Timeout": null
                },
                "children": []
            },
            "I2CPortRead": {
                "attrs": {
                    "Address": null,
                    "Length": null,
                    "Timeout": null
                },
                "children": []
            },
            "MsgSend": {
                "attrs": {
                    "FBlockId": null,
                    "FunctionId": null,
                    "OpTypeRequest": null,
                    "OpTypeResponse": null,
                    "PayloadRequest": null,
                    "PayloadResponse": null
                },
                "children": []
            },
            "Pause": {
                "attrs": {
                    "WaitTime": null
                },
                "children": []
            }
        };

        function completeAfter(cm, pred) {
        var cur = cm.getCursor();
        if (!pred || pred()) setTimeout(function() {
          if (!cm.state.completionActive)
            cm.showHint({completeSingle: false});
        }, 100);
        return CodeMirror.Pass;
      }
      function completeIfAfterLt(cm) {
        return completeAfter(cm, function() {
          var cur = cm.getCursor();
          return cm.getRange(CodeMirror.Pos(cur.line, cur.ch - 1), cur) == "<";
        });
      }
      function completeIfInTag(cm) {
        return completeAfter(cm, function() {
          var tok = cm.getTokenAt(cm.getCursor());
          if (tok.type == "string" && (!/['"]/.test(tok.string.charAt(tok.string.length - 1)) || tok.string.length == 1)) return false;
          var inner = CodeMirror.innerMode(cm.getMode(), tok.state).state;
          return inner.tagName;
        });
      }
      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        mode: "xml",
        lineNumbers: true,
        extraKeys: {
          "'<'": completeAfter,
          "'/'": completeIfAfterLt,
          "' '": completeIfInTag,
          "'='": completeIfInTag,
          "Ctrl-Space": "autocomplete"
        },
        hintOptions: {schemaInfo: tags}
      });
    </script>
</article>
